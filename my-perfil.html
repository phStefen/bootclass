<!doctype html>
<html lang="pt-br">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="icon" href="img/logo.svg" />
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">

  <!-- CSS  -->
  <link rel="stylesheet" href="css/feed.css">
  <title>Perfil \ BootClass</title>
</head>

<body>
  <div class="container-fluid">
    <div class="row">

      <!-- SECTION Esquerda -->
      <div class="col-3 position-fixed sidebar border-right px-4 py-2 logo">
        <!--ANCHOR Meu Perfil-->
        <div class="btn-group w-100 mt-1">
          <a type="button" class="btn btn-light bg-white" href="my-perfil.html">
            <div class="row p-2">
              <div class="col-auto">
                <img src="img/perfil.svg" alt="" width="60" height="60" class="rounded-circle fotoperfil">
              </div>
              <div class="col text-left">
                <span id="usernome">Nome do Usário</span>
                <br>
                <span>@<span id="useruser">Usuario</span></span>
              </div>
            </div>
          </a>
          <button type="button" class="btn btn-light dropdown-toggle dropdown-toggle-split btn-lg bg-white"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
          <div class="dropdown-menu dropdown-menu-right">
            <h6 class="dropdown-header">Configurações</h6>
            <button class="dropdown-item"
              onclick="localStorage.lembrar = 'false'; window.location.href = 'login.html'">Sair</button>
          </div>
        </div>


        <!--ANCHOR Matérias-->
        <h2 class="mt-3">
          Matérias
          <img src="img/materias.svg" height="30" width="30" alt="">
        </h2>
        <div class="list-group">
          <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Engenharia de Software I
            <span class="badge badge-custom badge-pill">0</span>
          </a>
          <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Algorítimo e Lógica de Programação II
            <span class="badge badge-custom badge-pill">0</span>
          </a>
          <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Desenvolvimento de Aplicações
            <span class="badge badge-custom badge-pill">0</span>
          </a>
          <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Banco de Dados I
            <span class="badge badge-custom badge-pill">0</span>
          </a>
        </div>
      </div>
      <!-- !SECTION -->

      <!-- SECTION Centro -->
      <div class="col-5 offset-3 center px-4">

        <!-- ANCHOR Navbar -->
        <nav class="navbar navbar-light bg-light sticky-top mx-n4">
          <span class="badge badge-custom px-4 py-2 rounded-pill">Meu Perfil</span>
          <a class="navbar-brand" href="index.html">
            <span class="icon icon-home icon-page"></span>
          </a>
          <a class="navbar-brand" href="#">
            <span class="icon icon-notification"></span>
          </a>
          <a class="navbar-brand" href="#">
            <span class="icon icon-message"></span>
          </a>
        </nav>

        <!-- ANCHOR Dados do Perfil -->
        <div class="card mt-3">
          <div class="container">
            <div class="row card-header bg-white">
              <div class="col-auto">
                <input type="file" style="display: none;" id="foto" accept="image/png, image/jpeg">
                <img id="editfoto" src="img/perfil.svg" height="60" width="60" class="rounded-circle fotoperfil">
              </div>
              <div class="col">
                <div class="row">
                  <strong id="perfilnome">Nome</strong>
                </div>
                <div class="row">
                  <span>@<span id="perfiluser">Usuário</span></span>
                </div>
              </div>
              <div class="col">
                <button class="btn float-right rounded-pill px-4 font-weight-bold btn-custom btn-perfil"
                  id="editperfil">Editar Perfil</button>
              </div>
            </div>

            <div class="card-body text-justify">
              <span id="perfilbio" class="d-inline">Edite seu Perfil para Alterar a sua Biografia</span>
              <textarea class="form-control input-custom d-none" placeholder="Como foi a Aula?" id="editbio"
                style="resize: none;"></textarea>
            </div>

            <div class="row text-center card-footer p-0">
              <nav class="nav nav-pills nav-fill w-100">
                <a class="nav-item nav-link tabs" href="#">Publicações</a>
                <a class="nav-item nav-link" href="#">Curtidas</a>
                <a class="nav-item nav-link" href="#">Arquivo</a>
              </nav>
            </div>
          </div>
        </div>

        <hr class="mt-5">

        <!-- SECTION Postagens -->
        <div id="feed">

        </div>
        <div class="my-5 text-center">
          <button type="button" class="btn btn-custom rounded-pill" id="carregar" onclick="carregarMaisMeu()">Mostrar
            Mais</button>
        </div>
        <!-- !SECTION -->

      </div>
      <!-- !SECTION -->

      <!-- SECTION Direita -->
      <div class="col-4 offset-8 position-fixed sidebar border-left px-4 py-2">
        <!--ANCHOR Buscar um Perfil-->

        <div class="input-group mt-1 bg-light rounded-pill border-0">
          <div class="input-group-prepend">
            <span
              class="input-group-text border-left-0 border-top-0 border-bottom-0 border-right bg-transparent mr-n5">@</span>
          </div>
          <input type="text" class="form-control input-custom rounded-pill bg-transparent px-5"
            placeholder="Buscar um Perfil">
        </div>

        <!--ANCHOR Atividades-->
        <h2 class="mt-3">Atividades <img src="img/atividade.svg" height="30" width="30" alt=""></h2>
        <div class="list-group">
          <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Nome da Atividade
            <span class="badge badge-primary badge-pill badge-success">30 dias</span>
          </a>
          <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Nome da Atividade
            <span class="badge badge-primary badge-pill badge-warning">10 dias</span>
          </a>
          <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
            Nome da Atividade
            <span class="badge badge-primary badge-pill badge-danger">7 dias</span>
          </a>
        </div>

        <!--ANCHOR Notícias-->
        <h2 class="mt-3">Notícias <img src="img/news.svg" height="30" width="30" alt=""></h2>
        <div class="list-group noticias">
          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1">Título da Notícia</h5>
              <small>Data</small>
            </div>
            <p class="mb-1">Resumo</p>
            <small>Site</small>
          </a>
          <a href="#" class="list-group-item list-group-item-action flex-column align-items-start">
            <div class="d-flex w-100 justify-content-between">
              <h5 class="mb-1">Título da Notícia</h5>
              <small>Data</small>
            </div>
            <p class="mb-1">Resumo</p>
            <small>Site</small>
          </a>
        </div>

        <!--ANCHOR Quem Seguir-->
        <h2 class="mt-3">Quem Seguir <img src="img/seguir.svg" height="30" width="30" alt=""></h2>
        <div class="list-group">
          <a href="#" class="list-group-item list-group-item-action">
            <img src="img/perfil.svg" height="40" class="rounded-circle">
            <strong>Nome do Usuário</strong>
            <span>@usuario</span>
            <button type="button" class="btn btn-custom rounded-pill px-3 float-right">Seguir</button>
          </a>
          <a href="#" class="list-group-item list-group-item-action">
            <img src="img/perfil.svg" height="40" class="rounded-circle">
            <strong>Nome do Usuário</strong>
            <span>@usuario</span>
            <button type="button" class="btn btn-custom rounded-pill px-3 float-right">Seguir</button>
          </a>
          <a href="#" class="list-group-item list-group-item-action">
            <img src="img/perfil.svg" height="40" class="rounded-circle">
            <strong>Nome do Usuário</strong>
            <span>@usuario</span>
            <button type="button" class="btn btn-custom rounded-pill px-3 float-right">Seguir</button>
          </a>
        </div>
      </div>
      <!-- !SECTION -->
    </div>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"></script>

  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.1/firebase-storage.js"></script>
  <script src="js/init.js"></script>
  <script src="js/toast.js"></script>
  <script src="js/post.js"></script>
  <script src="js/getinfo.js"></script>

  <script>
    var info = getInfo();
    var nome = info.nome;
    var user = info.user;
    var bio = info.bio;
    var cargo = info.cargo;
    var perfil = info.perfil;

    $('#usernome').text(nome);
    $('#useruser').text(user);

    $('#perfilnome').text(nome);
    $('#perfiluser').text(user);
    $('#perfilbio').text(bio);
    $('#editbio').text(bio);
    $('.fotoperfil').attr('src', perfil);

    $(".nav .nav-link").on("click", function () {
      $(".nav").find(".tabs").removeClass("tabs");
      $(this).addClass("tabs");
    });

    $(".navbar .navbar-brand").on("click", function () {
      $(".navbar").find(".icon-page").removeClass("icon-page");
      $(this).addClass("icon-page");
    });

    $('#editperfil').on('click', () => {
      $('#perfilbio').toggleClass('d-inline d-none');
      $('#editbio').toggleClass('d-block d-none');
      $('#editfoto').toggleClass('editavel');
      $('#editperfil').text($('#editperfil').text() === 'Editar Perfil' ? 'Salvar Alterações' : 'Editar Perfil');

      if ($('#editperfil').text() === 'Editar Perfil') {
        var novaBio = $('#editbio').val();
        var file = $('#foto').get(0).files;

        if (novaBio) {
          firebase.database().ref('usuarios/' + user + '/bio').set(novaBio);
          localStorage.setItem('bio', novaBio);
          $('#perfilbio').text(novaBio);
          $('#editbio').text(novaBio);
        }

        if (file.length > 0) {

          const ref = firebase.storage().ref();
          const name = new Date() + '-' + file[0].name;

          const metadata = { contentType: file[0].type }
          const task = ref.child(name).put(file[0], metadata);

          task
            .then(snapshot => snapshot.ref.getDownloadURL())
            .then(url => {
              firebase.database().ref('usuarios/' + user + '/perfil').set(url);
              setPerfil(url)
              $('.fotoperfil').attr('src', url);
            })
        }
      }
    });

    $(document).ready(function () {
      $('#editfoto').on('click', () => {
        if ($('#editfoto').hasClass('editavel')) {
          $('#foto').click();
        }
      })

      $('#foto').on('change', () => {
        var input = $('#foto').get(0).files;
        if(input.length > 0){
          var reader = new FileReader();
          reader.onload = (e) => {
            $('#editfoto').attr('src', e.target.result);
          };
          reader.readAsDataURL(input[0]);
        }
      })
    })

    //carregarMeusPost();
  </script>
</body>

</html>